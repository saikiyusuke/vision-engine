# 🎥 Airレジ操作記録ガイド

## 概要

あなたの手動操作を記録して、自動実行可能なスクリプトを生成する2つの方法を用意しました。

## 方法1: カスタム記録ツール（推奨）

### 使い方
```bash
node record-airregi.js
```

### 特徴
- クリックと入力を自動記録
- パスワードは自動的にマスク
- 操作履歴をJSON形式で保存
- 実行可能なスクリプトを自動生成
- 動画も同時に録画（recordings/フォルダ）

### 手順
1. コマンドを実行するとブラウザが開きます
2. 通常通りAirレジにログイン
3. CSVダウンロードまでの操作を行う
4. 完了したらブラウザを閉じる
5. 以下のファイルが生成されます：
   - `airregi-recorded-actions.json` - 操作履歴
   - `airregi-playback.js` - 再実行用スクリプト
   - `recordings/*.webm` - 操作の動画

### 再実行
```bash
node airregi-playback.js
```

## 方法2: Playwright Codegen（公式ツール）

### 使い方
```bash
./record-with-codegen.sh
```

### 特徴
- Playwrightの公式ツール
- リアルタイムでコード生成
- より詳細なセレクタを記録
- 手動で調整が必要な場合あり

### 手順
1. ブラウザとPlaywright Inspectorが開きます
2. ブラウザで操作を行う
3. Inspectorに自動的にコードが生成される
4. 完了したら生成されたコードをコピー
5. `airregi-codegen.js`として保存される

## 記録のコツ

### ✅ 推奨される操作方法
- **ゆっくり操作** - 各アクション間に1-2秒の間隔
- **明確なクリック** - ボタンの中心をクリック
- **入力完了を待つ** - 入力後にTabキーかクリックで確定
- **ページ読み込みを待つ** - 画面が完全に表示されてから次の操作

### ❌ 避けるべき操作
- 高速な連続クリック
- ドラッグ＆ドロップ
- 右クリックメニュー
- キーボードショートカット（Ctrl+Cなど）

## トラブルシューティング

### 記録がうまくいかない場合
1. ブラウザの開発者ツールでエラーを確認
2. より単純なセレクタを使用
3. 待機時間を増やす

### 再生がうまくいかない場合
1. 生成されたコードを手動で調整
2. セレクタが変わっていないか確認
3. タイムアウトを調整

## 高度な使い方

### 記録したアクションをカスタマイズ
```javascript
// airregi-recorded-actions.json を編集
{
  "type": "click",
  "selector": "button.login-button", // より具体的なセレクタに変更
  "text": "ログイン",
  "position": { "x": 640, "y": 500 }
}
```

### 条件分岐を追加
```javascript
// ログイン済みかチェック
const isLoggedIn = await page.$('div.user-menu') !== null;
if (!isLoggedIn) {
  // ログイン処理
}
```

## セキュリティ注意事項

⚠️ **重要**：
- 記録ファイルにはURLやクリック位置が含まれます
- パスワードは環境変数から読み込まれます
- 記録ファイルをGitにコミットする際は注意
- 動画ファイルは`.gitignore`に追加推奨

## 次のステップ

1. まず`record-airregi.js`で操作を記録
2. 生成された`airregi-playback.js`をテスト
3. 必要に応じてコードを調整
4. cronに組み込んで定期実行

---

これで、あなたの操作を完全に再現できる自動化スクリプトが作成できます！